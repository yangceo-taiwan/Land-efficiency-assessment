<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å®åœ‹åœ°æ”¿|æ˜“ä¸åœ°æ”¿ - åœŸåœ°é–‹ç™¼åƒ¹å€¼è©¦ç®—</title>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@300;400;500;700&family=Playfair+Display:wght@700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        :root {
            --primary-bg: #F5F7FA;
            --card-bg: #FFFFFF;
            --text-main: #2C3E50;
            --text-sub: #606F7B;
            --brand-dark: #1A252F;
            --brand-gold: #C5A065;
            --brand-gold-light: #E8D5B5;
            --brand-blue: #2980B9;
            --shadow-soft: 0 15px 35px rgba(26, 37, 47, 0.08);
            --radius: 16px;
        }

        * { box-sizing: border-box; outline: none; }
        body {
            font-family: 'Noto Sans TC', sans-serif;
            background: var(--primary-bg);
            color: var(--text-main);
            margin: 0;
            padding: 0;
            line-height: 1.6;
            display: flex;
            flex-direction: column;
            min-height: 100vh;
        }

        /* --- Header --- */
        .header {
            background: linear-gradient(135deg, #1A252F 0%, #2C3E50 100%);
            color: white;
            padding: 45px 20px 80px; /* å¢åŠ åº•éƒ¨ padding è®“ container ä¸Šç§»è¦†è“‹ */
            text-align: center;
            position: relative;
        }
        .header::after {
            content: '';
            position: absolute;
            bottom: 0; left: 0; right: 0;
            height: 10px;
            background: linear-gradient(to right, var(--brand-gold), #F0E1C7, var(--brand-gold));
            opacity: 0.8;
        }

        .logo-bar {
            display: flex;
            justify-content: center;
            align-items: center;
            flex-wrap: wrap;
            gap: 25px;
            margin-bottom: 25px;
        }
        .logo-bar img {
            height: 60px;
            background: rgba(255,255,255,0.95);
            padding: 6px 12px;
            border-radius: 8px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.3);
            transition: transform 0.3s;
        }
        .logo-bar img:hover { transform: translateY(-3px); }

        .header h1 { margin: 0; text-shadow: 0 2px 10px rgba(0,0,0,0.3); }
        .brand-prefix {
            display: block;
            font-size: 1.1rem;
            color: var(--brand-gold);
            letter-spacing: 3px;
            margin-bottom: 8px;
            font-weight: 500;
            text-transform: uppercase;
        }
        .brand-name-cn {
            display: block;
            font-size: 2.2rem;
            font-weight: 700;
            letter-spacing: 2px;
            margin-bottom: 5px;
        }
        .brand-name-en {
            font-family: 'Playfair Display', serif;
            font-size: 0.95rem;
            color: #BDC3C7;
            letter-spacing: 1px;
            opacity: 0.8;
        }

        /* --- Main Layout --- */
        .container {
            max-width: 1100px;
            margin: -50px auto 40px; /* è² é‚Šè·è®“å¡ç‰‡å¾€ä¸Šè“‹ä½ Header */
            padding: 0 20px;
            display: grid;
            grid-template-columns: 1fr;
            gap: 30px;
            position: relative;
            z-index: 10;
            flex-grow: 1;
        }
        @media(min-width: 900px) {
            .container { 
                grid-template-columns: 420px 1fr; 
                align-items: start; /* è®“å…©é‚Šå¡ç‰‡ä¾å…§å®¹é«˜åº¦è‡ªç„¶å»¶ä¼¸ */
            }
        }

        /* --- Cards --- */
        .card {
            background: var(--card-bg);
            border-radius: var(--radius);
            padding: 35px;
            box-shadow: var(--shadow-soft);
            border: 1px solid rgba(255,255,255,0.5);
            height: fit-content; /* é‡è¦ï¼šè®“å¡ç‰‡é«˜åº¦é©æ‡‰å…§å®¹ */
        }
        .card-title {
            font-size: 1.15rem;
            font-weight: 700;
            color: var(--brand-dark);
            margin-bottom: 25px;
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding-bottom: 15px;
            border-bottom: 2px solid #F0F0F0;
        }
        .card-title span i { color: var(--brand-blue); margin-right: 10px; }

        /* --- Inputs --- */
        .input-group { margin-bottom: 20px; }
        .label {
            display: block; font-size: 0.85rem; font-weight: 700; color: var(--text-sub);
            margin-bottom: 8px; letter-spacing: 0.5px;
        }
        .input {
            width: 100%; padding: 12px 15px;
            border: 1px solid #E2E8F0; border-radius: 8px;
            font-size: 1rem; text-align: right;
            font-family: 'Playfair Display', 'Noto Sans TC';
            background: #FAFBFC; transition: all 0.3s;
            color: var(--brand-dark);
            font-weight: 500;
        }
        .input:focus {
            border-color: var(--brand-blue); background: #FFF;
            box-shadow: 0 0 0 3px rgba(41, 128, 185, 0.1);
        }
        .input-readonly { background: #F1F5F9; color: #94A3B8; border-color: transparent; cursor: default; }
        select.input { text-align: left; cursor: pointer; appearance: none; background-image: url("data:image/svg+xml;charset=UTF-8,%3csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24' fill='none' stroke='%232980B9' stroke-width='2' stroke-linecap='round' stroke-linejoin='round'%3e%3cpolyline points='6 9 12 15 18 9'%3e%3c/polyline%3e%3c/svg%3e"); background-repeat: no-repeat; background-position: right 15px center; background-size: 16px; padding-right: 40px; }

        .input-row { display: flex; gap: 15px; align-items: flex-end; margin-bottom: 20px; }
        .input-col { flex: 1; }

        /* --- Calc Sections --- */
        .calc-section {
            background: #F8FAFC; padding: 20px; border-radius: 12px; margin-bottom: 25px; border: 1px solid #EEF2F6;
        }
        .calc-section-title { 
            font-size: 0.9rem; font-weight: 700; color: var(--brand-dark); 
            margin-bottom: 15px; display: flex; align-items: center; 
        }
        .calc-section-title i { color: var(--brand-gold); margin-right: 8px; }

        /* --- Highlight Box --- */
        .highlight-box {
            background: linear-gradient(135deg, #FFFEFB 0%, #FFF5E6 100%);
            border: 1px solid var(--brand-gold-light);
            border-radius: 12px;
            padding: 25px;
            margin-top: 25px;
            text-align: center;
            box-shadow: 0 8px 20px rgba(197, 160, 101, 0.1);
            position: relative;
            overflow: hidden;
        }
        .highlight-box::before {
            content: '\f201'; /* chart-line icon */
            font-family: "Font Awesome 6 Free"; font-weight: 900;
            position: absolute; top: -10px; right: 10px;
            font-size: 5rem; color: var(--brand-gold); opacity: 0.05;
            transform: rotate(-15deg);
        }
        .highlight-box label { color: var(--brand-gold); font-size: 0.9rem; font-weight: 700; letter-spacing: 1px; display: block; margin-bottom: 5px;}
        .big-input {
            width: 100%; border: none; background: transparent;
            font-family: 'Playfair Display', serif;
            font-size: 3.5rem; font-weight: 700; color: var(--brand-dark);
            text-align: center; margin: 5px 0; outline: none;
            border-bottom: 2px dashed #E0E0E0; padding-bottom: 0;
            transition: border 0.3s;
        }
        .big-input:focus { border-bottom: 2px solid var(--brand-gold); }
        
        .reset-btn { color: #999; transition: color 0.3s; }
        .reset-btn:hover { color: var(--brand-blue); }

        .btn-restore {
            font-size: 0.8rem; color: var(--brand-blue); background: rgba(41, 128, 185, 0.1);
            border: none; padding: 4px 10px; border-radius: 20px; cursor: pointer; margin-left: 8px;
            transition: all 0.2s;
        }
        .btn-restore:hover { background: var(--brand-blue); color: white; }

        /* --- Analysis & Visuals (Right Side) --- */
        .bar-container { margin: 10px 0 30px; }
        .bar-label { display: flex; justify-content: space-between; font-size: 0.9rem; margin-bottom: 10px; color: var(--text-sub); font-weight: 500; }
        .progress-bg { height: 12px; background: #EDF2F7; border-radius: 6px; overflow: hidden; display:flex; }
        .progress-seg { height: 100%; transition: width 0.8s cubic-bezier(0.4, 0, 0.2, 1); }
        .legend { display: flex; gap: 15px; margin-top: 12px; font-size: 0.8rem; color: #94A3B8; }
        .legend span { display: flex; align-items: center; }
        .legend i { font-size: 0.6rem; margin-right: 6px; }

        .eff-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 15px; margin-bottom: 30px; }
        .eff-item {
            background: #FFFFFF; padding: 20px; border-radius: 12px; text-align: center;
            border: 1px solid #EEF2F6; box-shadow: 0 4px 10px rgba(0,0,0,0.03);
        }
        .eff-val { font-size: 1.8rem; font-weight: 700; color: var(--brand-dark); font-family: 'Playfair Display'; }
        .eff-title { font-size: 0.85rem; color: var(--text-sub); margin-top: 5px; }

        /* --- Integrated CTA & Disclaimer (Moved to Right Card) --- */
        .right-card-footer {
            margin-top: 30px;
            padding-top: 30px;
            border-top: 2px dashed #EEF2F6;
        }
        
        .btn-line {
            display: flex; align-items: center; justify-content: center; gap: 12px;
            background: #06C755; color: white; width: 100%; padding: 16px;
            border-radius: 12px; font-size: 1.05rem; font-weight: 700; text-decoration: none;
            box-shadow: 0 8px 20px rgba(6, 199, 85, 0.2); transition: all 0.3s ease; border: none; cursor: pointer;
            margin-bottom: 20px;
        }
        .btn-line:hover { background: #05B34C; transform: translateY(-2px); box-shadow: 0 12px 25px rgba(6, 199, 85, 0.35); }
        
        .disclaimer-box {
            background: #FFFBF2;
            border-radius: 8px;
            padding: 15px;
            font-size: 0.8rem;
            color: #8D6E63;
            line-height: 1.6;
            display: flex; gap: 12px; align-items: flex-start;
        }
        .disclaimer-box i { color: #F59E0B; margin-top: 3px; font-size: 1rem; }

        /* --- New Site Footer (Dark) --- */
        .site-footer {
            background: #1A252F;
            color: #ECF0F1;
            padding: 40px 20px;
            margin-top: auto; /* Push to bottom */
            text-align: center;
            border-top: 4px solid var(--brand-gold);
        }
        
        .social-links {
            display: flex;
            justify-content: center;
            gap: 15px;
            flex-wrap: wrap;
            margin-bottom: 25px;
        }
        .btn-social {
            display: inline-flex; align-items: center; gap: 8px;
            padding: 10px 20px; border-radius: 50px;
            font-size: 0.9rem; text-decoration: none;
            color: #1A252F; background: white;
            font-weight: 600; transition: all 0.3s;
        }
        .btn-social:hover { transform: translateY(-3px); background: var(--brand-gold); color: white; }
        .btn-social i { font-size: 1.1rem; }

        .copyright {
            font-size: 0.75rem;
            color: #7F8C8D;
            border-top: 1px solid rgba(255,255,255,0.1);
            padding-top: 20px;
            max-width: 600px;
            margin: 0 auto;
        }

        @media print {
            .btn-line, .btn-restore, .reset-btn, .site-footer { display: none; }
            body { background: white; padding: 0; }
            .container { margin-top: 0; }
            .card { box-shadow: none; border: 1px solid #000; }
            .header { background: white; color: black; padding: 20px; }
            .logo-bar img { background: none; box-shadow: none; }
        }
    </style>
</head>
<body>

<div class="header">
    <div class="logo-bar">
        <img src="å®åœ‹åœ°æ”¿å°é¢.jpg" alt="å®åœ‹åœ°æ”¿">
        <img src="æ˜“ä¸logo-01.jpg" alt="æ˜“ä¸åœ°æ”¿å£«äº‹å‹™æ‰€">
    </div>
    <h1>
        <span class="brand-prefix">å®åœ‹åœ°æ”¿ï½œæ˜“ä¸åœ°æ”¿</span>
        <span class="brand-name-cn">åœŸåœ°é–‹ç™¼åƒ¹å€¼è©¦ç®—</span>
        <span class="brand-name-en">Premium Land Efficiency Assessment System</span>
    </h1>
</div>

<div class="container">
    
    <div class="card">
        <div class="card-title">
            <span><i class="fas fa-sliders-h"></i> åŸºåœ°èˆ‡å®¹ç©è¨­å®š</span>
            <button onclick="reset()" class="reset-btn" style="background:none; border:none; cursor:pointer; font-size:0.85rem; display:flex; align-items:center;">
                <i class="fas fa-undo-alt" style="margin-right:6px;"></i> é‡ç½®
            </button>
        </div>
        
        <div class="input-row">
            <div class="input-col">
                <label class="label">åœŸåœ°åªæ•¸</label>
                <input type="number" id="inPing" class="input" value="52" oninput="calc()">
            </div>
            <div class="input-col">
                <label class="label">æ›ç®— mÂ²</label>
                <input type="text" id="outSqm" class="input input-readonly" readonly>
            </div>
        </div>

        <div class="input-group">
            <label class="label">é–‹ç™¼ç”¢å“é¡å‹</label>
            <select id="inType" class="input" onchange="toggleType(); calc();">
                <option value="tou-tian">é€å¤©åˆ¥å¢… (å»ºè”½ç‡æ¨ç®—)</option>
                <option value="da-lou">å¤§æ¨“è¯å»ˆ (å®¹ç©ç‡æ¨ç®—)</option>
            </select>
        </div>

        <div class="calc-section">
            <div class="calc-section-title"><i class="fas fa-gavel"></i> æ³•å®šåƒæ•¸è¨­å®š</div>
            <div class="input-row">
                <div class="input-col">
                    <label class="label">æ³•å®šå»ºè”½ç‡ %</label>
                    <input type="number" id="inBCR" class="input" value="60" oninput="calc()">
                </div>
                <div class="input-col">
                    <label class="label">æ³•å®šå®¹ç©ç‡ %</label>
                    <input type="number" id="inBaseFAR" class="input" value="200" oninput="calc()">
                </div>
            </div>
            <div class="input-group" style="text-align:right; margin-bottom:0;">
                <span style="font-size:0.85rem; color:var(--brand-blue); font-weight:600;">
                    æœ€å¤§å–®å±¤é¢ç©ï¼š<span id="txtMaxFootprint" style="font-family:'Playfair Display'; font-size:1.1rem;">0</span> åª
                </span>
            </div>
        </div>

        <div id="groupTouTian" class="calc-section">
            <div class="calc-section-title"><i class="fas fa-home"></i> é€å¤©è¦åŠƒç´°ç¯€</div>
            <div class="input-row">
                <div class="input-col">
                    <label class="label">è¦åŠƒæ¨“å±¤</label>
                    <input type="number" id="inFloors" class="input" value="4" oninput="calc()">
                </div>
                <div class="input-col">
                    <label class="label">é™„å±¬ä¿‚æ•¸</label>
                    <input type="number" id="inTouTianEff" class="input" value="1.15" step="0.05" oninput="calc()">
                </div>
            </div>
            <p style="font-size:0.75rem; color:#999; margin-top:8px;">* ä¿‚æ•¸ 1.15 å«é™½å°(10%) + å±‹çª(12.5%)ã€‚</p>
        </div>

        <div id="groupDaLou" class="calc-section" style="display:none;">
            <div class="calc-section-title"><i class="fas fa-building"></i> å¤§æ¨“å®¹ç©å †ç–Š</div>
            <div class="input-row">
                <div class="input-col">
                    <label class="label" style="color:var(--brand-gold);">+ çå‹µå®¹ç© %</label>
                    <input type="number" id="inBonusFAR" class="input" value="20" placeholder="å±è€/éƒ½æ›´" oninput="calc()">
                </div>
                <div class="input-col">
                    <label class="label" style="color:var(--brand-gold);">+ å®¹ç©ç§»è½‰ %</label>
                    <input type="number" id="inTransferFAR" class="input" value="0" placeholder="å…¬ä¿åœ°" oninput="calc()">
                </div>
            </div>
            <div class="input-group">
                <label class="label">éŠ·åªä¿‚æ•¸</label>
                <input type="number" id="inEffFactor" class="input" value="1.45" step="0.05" oninput="calc()">
                <p style="font-size:0.75rem; color:#999; margin-top:8px;">* ä¿‚æ•¸ 1.45~1.50 (å«é™½å°/æ¢¯å»³/æ©Ÿæˆ¿)ã€‚è‹¥å«è»Šä½åªæ•¸å¯è¨­ 1.6 ä»¥ä¸Šã€‚</p>
            </div>
        </div>

        <div class="highlight-box">
            <label>â˜… é ä¼°å¯éŠ·å”®ç¸½å»ºåª (å¯æ‰‹å‹•ä¿®æ”¹)</label>
            <input type="number" id="outSaleArea" class="big-input" value="0" oninput="updateKPI()">
            <div style="margin-top:10px;">
                <span style="font-size:0.8rem; color:#94A3B8;">ç³»çµ±ä¼°ç®—å€¼ï¼š<span id="sysEstVal" style="font-weight:700; color:var(--brand-dark);">0</span> åª</span>
                <button class="btn-restore" onclick="resetToEst()">
                    <i class="fas fa-sync-alt"></i> æ¢å¾©
                </button>
            </div>
        </div>
    </div>

    <div class="card">
        <div class="card-title">
            <span><i class="fas fa-chart-pie"></i> é–‹ç™¼æ•ˆç›Šåˆ†æ</span>
            <span style="font-size:0.85rem; color:var(--text-sub); font-weight:normal; font-family:'Playfair Display'; letter-spacing:1px;">Value Analysis</span>
        </div>
        
        <div class="bar-container">
            <div class="bar-label">
                <span>å®¹ç©çµæ§‹åˆ†æ</span>
                <span id="txtTotalVol" style="color:var(--brand-blue); font-weight:700;">0%</span>
            </div>
            <div class="progress-bg">
                <div id="barBase" class="progress-seg" style="background:#BDC3C7; width:60%"></div>
                <div id="barBonus" class="progress-seg" style="background:var(--brand-gold); width:20%"></div>
                <div id="barTransfer" class="progress-seg" style="background:var(--brand-blue); width:20%"></div>
            </div>
            <div class="legend">
                <span><i class="fas fa-square" style="color:#BDC3C7;"></i> æ³•å®š</span>
                <span><i class="fas fa-square" style="color:var(--brand-gold);"></i> çå‹µ</span>
                <span><i class="fas fa-square" style="color:var(--brand-blue);"></i> ç§»è½‰</span>
            </div>
        </div>

        <div class="eff-grid">
            <div class="eff-item">
                <div class="eff-val" id="valEff">0.0</div>
                <div class="eff-title">åœŸåœ°åªæ•ˆ (å€)</div>
            </div>
            <div class="eff-item">
                <div class="eff-val" id="valAddOn" style="color:var(--brand-gold)">+0</div>
                <div class="eff-title">å‰µé€ åªæ•¸</div>
            </div>
        </div>

        <div style="margin-top:20px; border-bottom:1px solid #EEE; padding-bottom:20px;">
            <label class="label" style="margin-bottom:10px;">åƒæ•¸è¨­å®šèªªæ˜</label>
            <ul style="font-size:0.85rem; color:var(--text-sub); line-height:1.7; padding-left:20px; margin:0;">
                <li><strong>å»ºè”½ç‡ (BCR)</strong>ï¼šæ±ºå®šå–®å±¤æœ€å¤§é¢ç© (èƒ–ç˜¦)ã€‚</li>
                <li><strong>å®¹ç©ç‡ (FAR)</strong>ï¼šæ±ºå®šç¸½æ¨“åœ°æ¿é¢ç© (é«˜çŸ®)ã€‚</li>
                <li><strong>é€å¤©ä¼°ç®—</strong>ï¼šåœ°åª Ã— å»ºè”½ç‡ Ã— æ¨“å±¤ Ã— 1.15 (é™„å±¬)ã€‚</li>
                <li><strong>å¤§æ¨“ä¼°ç®—</strong>ï¼šåœ°åª Ã— (æ³•å®š+çå‹µ) Ã— 1.45 (å…¬è¨­)ã€‚</li>
            </ul>
        </div>

        <div class="right-card-footer">
            <button class="btn-line" onclick="sendToLine()">
                <i class="fab fa-line" style="font-size:1.6rem;"></i>
                ç´¢å–ã€Œç¨…å¾Œæ·¨åˆ©ã€ç²¾ç®—å ±å‘Š
            </button>

            <div class="disclaimer-box">
                <i class="fas fa-exclamation-triangle"></i>
                <div>
                    <strong>å…è²¬è²æ˜</strong><br>
                    æœ¬è©¦ç®—çµæœåƒ…ä¾ä¸€èˆ¬æ³•è¦é‚è¼¯æ¨ç®—ï¼ŒæœªåŒ…å«åŸºåœ°å€‹åˆ¥å·®ç•°ï¼ˆå¦‚åœ°å½¢ã€æŒ‡å®šå»ºç¯‰ç·šã€åœ°æ–¹è‡ªæ²»æ¢ä¾‹ç­‰ï¼‰ä¹‹å½±éŸ¿ã€‚å¯¦éš›é–‹ç™¼æ•ˆç›Šè«‹ä»¥é–‹æ¥­å»ºç¯‰å¸«ä¹‹è©³ç´°è©•ä¼°èˆ‡ç°½è­‰ç‚ºæº–ã€‚
                </div>
            </div>
        </div>
    </div>

</div>

<footer class="site-footer">
    <div class="social-links">
        <a href="https://maps.app.goo.gl/qyKhdrKsG5QBo2BW8" target="_blank" class="btn-social">
            <i class="fas fa-map-marker-alt" style="color:#EA4335;"></i> Google åœ°åœ–
        </a>
        <a href="https://www.facebook.com/062582589a/" target="_blank" class="btn-social">
            <i class="fab fa-facebook" style="color:#1877F2;"></i> FB ç²‰çµ²å°ˆé 
        </a>
        <a href="https://line.me/ti/g2/aVklWxyLP1RtfstQsslGQOlP4KViuFI7PPucdQ?utm_source=invitation&utm_medium=link_copy&utm_campaign=default" target="_blank" class="btn-social">
            <i class="fas fa-users" style="color:#E67E22;"></i> VIP ç¤¾ç¾¤
        </a>
    </div>
    <div class="copyright">
        &copy; 2023 å®åœ‹åœ°æ”¿ï½œæ˜“ä¸åœ°æ”¿ All Rights Reserved.
    </div>
</footer>

<script>
    const PING_TO_SQM = 3.305785;
    
    // UI Elements
    const ui = {
        ping: document.getElementById('inPing'),
        sqm: document.getElementById('outSqm'),
        type: document.getElementById('inType'),
        
        // Common Input
        bcr: document.getElementById('inBCR'),
        baseFAR: document.getElementById('inBaseFAR'),
        txtMaxFootprint: document.getElementById('txtMaxFootprint'),

        // Groups
        groupDaLou: document.getElementById('groupDaLou'),
        groupTouTian: document.getElementById('groupTouTian'),

        // Da-Lou Inputs
        bonusFAR: document.getElementById('inBonusFAR'),
        transferFAR: document.getElementById('inTransferFAR'),
        effFactor: document.getElementById('inEffFactor'),

        // Tou-Tian Inputs
        floors: document.getElementById('inFloors'),
        touTianEff: document.getElementById('inTouTianEff'),

        // Output
        outSaleArea: document.getElementById('outSaleArea'),
        sysEstVal: document.getElementById('sysEstVal'),
        
        // KPI & Visuals
        valEff: document.getElementById('valEff'),
        valAddOn: document.getElementById('valAddOn'),
        
        barBase: document.getElementById('barBase'),
        barBonus: document.getElementById('barBonus'),
        barTransfer: document.getElementById('barTransfer'),
        txtTotalVol: document.getElementById('txtTotalVol')
    };

    let calculatedArea = 0;

    function reset() {
        ui.ping.value = 52;
        ui.baseFAR.value = 200;
        ui.bcr.value = 60;
        ui.bonusFAR.value = 20;
        ui.transferFAR.value = 0;
        ui.effFactor.value = 1.45;
        calc();
    }

    function toggleType() {
        if(ui.type.value === 'tou-tian') {
            ui.groupTouTian.style.display = 'block';
            ui.groupDaLou.style.display = 'none';
        } else {
            ui.groupTouTian.style.display = 'none';
            ui.groupDaLou.style.display = 'block';
        }
        calc();
    }

    function resetToEst() {
        ui.outSaleArea.value = calculatedArea.toFixed(1);
        updateKPI();
    }

    function calc() {
        let ping = parseFloat(ui.ping.value) || 0;
        ui.sqm.value = (ping * PING_TO_SQM).toFixed(2);

        let type = ui.type.value;
        let bcr = parseFloat(ui.bcr.value) || 0;
        
        // é¡¯ç¤ºæœ€å¤§å–®å±¤é¢ç©
        let maxFootprint = ping * (bcr / 100);
        ui.txtMaxFootprint.innerText = maxFootprint.toFixed(1);

        let estArea = 0;
        let baseVolArea = 0;

        if (type === 'da-lou') {
            // å¤§æ¨“é‚è¼¯: (æ³•å®š + çå‹µ + ç§»è½‰) * ä¿‚æ•¸
            let base = parseFloat(ui.baseFAR.value) || 0;
            let bonus = parseFloat(ui.bonusFAR.value) || 0;
            let trans = parseFloat(ui.transferFAR.value) || 0;
            let factor = parseFloat(ui.effFactor.value) || 1.45;

            let totalVolPercent = base + bonus + trans;
            
            // è¦–è¦ºåŒ– Bar Chart æ›´æ–°
            let total = totalVolPercent || 1; // avoid zero div
            ui.barBase.style.width = (base / total * 100) + "%";
            ui.barBonus.style.width = (bonus / total * 100) + "%";
            ui.barTransfer.style.width = (trans / total * 100) + "%";
            ui.txtTotalVol.innerText = "ç¸½æ ¸å®šå®¹ç©: " + totalVolPercent + "%";

            baseVolArea = ping * (base / 100); // ç´”æ³•å®šå®¹ç©é¢ç©
            let totalVolArea = ping * (totalVolPercent / 100);
            
            // é ä¼°éŠ·åª
            estArea = totalVolArea * factor;

        } else {
            // é€å¤©é‚è¼¯: åœ°åª * å»ºè”½ * æ¨“å±¤ * ä¿‚æ•¸
            let floors = parseFloat(ui.floors.value) || 0;
            let factor = parseFloat(ui.touTianEff.value) || 1.15;

            // é€å¤©é¡¯ç¤ºå»ºè”½çµæ§‹ (éš±è— Bar æˆ–æ”¹ç”¨é€”)
            ui.barBase.style.width = "100%";
            ui.barBonus.style.width = "0%";
            ui.barTransfer.style.width = "0%";
            ui.txtTotalVol.innerText = "é€å¤©ä¾å»ºè”½ç‡èˆ‡æ¨“å±¤è¨ˆç®—";

            baseVolArea = maxFootprint * floors; // ä¸»å»ºç‰© (å–®å±¤ x æ¨“å±¤)
            estArea = baseVolArea * factor;
        }

        calculatedArea = estArea;
        ui.sysEstVal.innerText = estArea.toFixed(1);
        
        // è‹¥ä½¿ç”¨è€…æœªæ‰‹å‹•æ”¹é(æˆ–æ˜¯0)ï¼Œè‡ªå‹•å¸¶å…¥
        if(parseFloat(ui.outSaleArea.value) === 0) {
            ui.outSaleArea.value = estArea.toFixed(1);
        }
        
        updateKPI();
    }

    function updateKPI() {
        let realArea = parseFloat(ui.outSaleArea.value) || 0;
        let ping = parseFloat(ui.ping.value) || 0;

        // 1. åªæ•ˆ
        let eff = (ping > 0) ? (realArea / ping) : 0;
        ui.valEff.innerText = eff.toFixed(2);

        // 2. å‰µé€ åƒ¹å€¼ (Sales Area - Statutory Area)
        // éœ€é‡æ–°è¨ˆç®— Statutory Area ä¾›æ¯”è¼ƒ
        let type = ui.type.value;
        let statArea = 0;
        
        if (type === 'da-lou') {
            let base = parseFloat(ui.baseFAR.value) || 0;
            statArea = ping * (base / 100);
        } else {
            let bcr = parseFloat(ui.bcr.value) || 0;
            let floors = parseFloat(ui.floors.value) || 0;
            statArea = ping * (bcr/100) * floors;
        }

        let added = realArea - statArea;
        ui.valAddOn.innerText = (added > 0 ? "+" : "") + added.toFixed(1) + " åª";
    }

    function sendToLine() {
        let area = ui.ping.value;
        let saleArea = ui.outSaleArea.value;
        let type = (ui.type.value === 'tou-tian') ? 'é€å¤©' : 'å¤§æ¨“';
        
        let msg = `ğŸ‘‹ æ‚¨å¥½ï¼Œæˆ‘å‰›å¹«å®¢æˆ¶è©•ä¼°äº†ä¸€å¡Šåœ°ï¼Œæƒ³ç”³è«‹é€²ä¸€æ­¥çš„è²¡å‹™åˆ†æï¼š\n\n` +
                  `ğŸ“ åŸºåœ°è³‡è¨Šï¼š\n` +
                  `â€¢ é¢ç©ï¼š${area} åª\n` +
                  `â€¢ è¦åŠƒï¼š${type}\n` +
                  `â€¢ é ä¼°éŠ·åªï¼š${saleArea} åª\n\n` +
                  `å®¢æˆ¶æƒ³äº†è§£ï¼š\n` +
                  `1. é ä¼°ç‡Ÿå»ºæˆæœ¬\n` +
                  `2. ç¨…å¾Œæ·¨åˆ©è©¦ç®—\n` +
                  `è«‹å”åŠ©å®‰æ’ï¼Œè¬è¬ï¼`;

        let lineUrl = `https://line.me/R/oaMessage/@604gpqef/?${encodeURIComponent(msg)}`;
        window.open(lineUrl, '_blank');
    }

    // Init
    calc();
</script>

</body>
</html>